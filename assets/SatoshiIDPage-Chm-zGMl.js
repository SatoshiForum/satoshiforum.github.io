import{_ as D,c,o as h,b as r,w as n,a as t,i as d,r as i,k as z,t as _,d as m,U as g,E as y,C as p,u as P,s as U}from"./index-DSfp38Jk.js";const V={name:"SatoshiIDPage",data(){return{Search:U,searchName:"",searchResult:null,searching:!1,txSent:!1}},computed:{userStore(){return P()}},activated(){let a=this;this.timer=setInterval(()=>{a.userStore.resolveSatoshiID()},4e3)},deactivated(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{async handleSearch(){if(this.txSent=!1,this.searchName=this.searchName.trim().toLowerCase(),!this.searchName){y.warning("Please enter a SatoshiID name");return}let a=null,e=null,f=null;do{if(!/^[0-9a-z_]{1,48}$/.test(this.searchName)){a="Only contains 0-9, a-z, _. Max 48 characters";break}this.searching=!0;try{const o=await p.queryName(this.searchName);if(this.searching=!1,console.log("handleSearch: ",o),!o.result){a="Invalid name.";break}if(!o.available){f=o.owner,a="Owned by ";break}e=o.price}catch{a="Query fail, please retry later.",this.searching=!0;break}}while(!1);this.searchResult={name:this.searchName,available:!a,price:e,owner:f,message:a?`"${this.searchName}" not avaiable. Reason: ${a}`:`"${this.searchName}" is available for registration!`}},async handleRegister(){if(!this.userStore.isConnected){y.warning("Please connect your wallet first");return}if(await p.loadSatoshiTokenBalance(this.userStore.walletAddress)<this.searchResult.price){g.alert("$Satoshi unenough");return}p.registerSatoshiID(this.userStore.walletAddress,this.searchName,this.searchResult.price),this.txSent=!0},handleSetPrimary(){if(!this.userStore.isConnected){y.warning("Please connect your wallet first");return}p.setPrimarySatoshiID(this.searchResult.name)},addressLink(a){return g.addressLink(a)}}},B={class:"satoshi-id-page"},L={class:"register-section"},A={class:"search-wrapper"},E={key:0,class:"search-result"},K={key:0},M=["href"],T={key:0,class:"register-info"},H={class:"price-display"},O={class:"price"},q={key:1},Q={key:1,class:"id-info"},W={class:"info-item"},Y={class:"info-item"},j={class:"info-item"};function F(a,e,f,o,s,l){const S=i("el-button"),w=i("el-input"),v=i("Coin"),u=i("el-icon"),k=i("el-result"),b=i("User"),R=i("Lock"),N=i("Star"),C=i("el-space"),I=i("el-card");return h(),c("div",B,[r(I,{class:"id-card"},{default:n(()=>[e[8]||(e[8]=t("div",{class:"id-header"},[t("h2",null,"SatoshiID"),t("p",{class:"subtitle"},"Decentralized Identity secured by Bitcoin")],-1)),t("div",L,[t("div",A,[r(w,{modelValue:s.searchName,"onUpdate:modelValue":e[0]||(e[0]=x=>s.searchName=x),size:"large",placeholder:"Search SatoshiID (e.g., satoshi)",onKeyup:z(l.handleSearch,["enter"]),clearable:""},{append:n(()=>[r(S,{icon:s.Search,onClick:l.handleSearch,loading:s.searching},null,8,["icon","onClick","loading"])]),_:1},8,["modelValue","onKeyup"])]),s.searchResult?(h(),c("div",E,[r(k,{icon:s.searchResult.available?"success":"error"},{"sub-title":n(()=>[m(_(s.searchResult.message)+" ",1),s.searchResult.owner?(h(),c("span",K,[t("a",{href:l.addressLink(s.searchResult.owner),target:"_blank",class:"wallet-address"},_(s.searchResult.owner==l.userStore.walletAddress?"Yourself":s.searchResult.owner),9,M),e[1]||(e[1]=m(" . ",-1))])):d("",!0)]),extra:n(()=>[s.searchResult.available?(h(),c("div",T,[t("div",H,[r(u,{class:"coin-icon"},{default:n(()=>[r(v)]),_:1}),t("span",O,_(s.searchResult.price/100000000n),1),e[2]||(e[2]=t("span",{class:"token"},"$Satoshi",-1))]),r(S,{type:"primary",size:"large",onClick:l.handleRegister,disabled:!l.userStore.isConnected||s.txSent},{default:n(()=>[m(_(s.txSent?"Transaction sent":"Register Now"),1)]),_:1},8,["onClick","disabled"])])):d("",!0),s.searchResult.owner==l.userStore.walletAddress&&s.searchResult.name!=l.userStore.satoshiID?(h(),c("div",q,[r(S,{type:"primary",size:"large",onClick:l.handleSetPrimary},{default:n(()=>[...e[3]||(e[3]=[m(" Set primary ",-1)])]),_:1},8,["onClick"])])):d("",!0)]),_:1},8,["icon"])])):d("",!0),s.searchResult?d("",!0):(h(),c("div",Q,[e[7]||(e[7]=t("h3",null,"What is SatoshiID?",-1)),r(C,{direction:"vertical",size:16,style:{width:"100%"}},{default:n(()=>[t("div",W,[r(u,{color:"#409eff"},{default:n(()=>[r(b)]),_:1}),e[4]||(e[4]=t("span",null,"Human-readable identity on Bitcoin",-1))]),t("div",Y,[r(u,{color:"#409eff"},{default:n(()=>[r(R)]),_:1}),e[5]||(e[5]=t("span",null,"Secure and decentralized ownership",-1))]),t("div",j,[r(u,{color:"#409eff"},{default:n(()=>[r(N)]),_:1}),e[6]||(e[6]=t("span",null,"Use across the ecosystem",-1))])]),_:1})]))])]),_:1})])}const J=D(V,[["render",F],["__scopeId","data-v-b1e22fdc"]]);export{J as default};
