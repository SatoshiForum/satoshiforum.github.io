import{_ as I,c as u,o as c,b as d,e as L,a as n,w as h,d as g,r as m,f as B,g as P,t as r,i as w,F as N,h as z,U as C,E as k,C as i,N as _,u as x,j as V}from"./index-BFml0a8e.js";const E={name:"PostPage",data(){return{ArrowLeft:V,post:{},totalPage:0,totalComments:0,currentPage:1,pageSize:20,loading:!1,floors:[],newComment:"",likeCost:0n,commentCost:0n,categoryNameList:[]}},computed:{userStore(){return x()},postId(){return this.$route.params.id}},async mounted(){let t=this;this.timer=setInterval(async()=>{t.post.id&&(t.reloadPost(),t.floors.length<this.pageSize&&t.loadComments())},5e3),C.registerEventByType("nameEntryUpdate",function(l){for(const a of t.floors)a.author==l.data.address&&(a.authorStr=l.data.name)}),await this.loadPostAndContent(),await this.loadComments();const e=await i.queryForumBatchInfo();this.likeCost=e.likeCost,this.commentCost=e.commentCost,this.categoryNameList=e.categoryNames},unmounted(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{async loadPostAndContent(){this.loading=!0;const t=await i.loadPostSummary(this.postId),e=await i.loadPostContent(this.postId);this.post={id:this.postId,title:t.title,category:t.categoryId,author:t.creator,authorStr:_.resolveAddress(t.creator),content:e,createdAt:t.createBlock,likeCount:t.likeCount},this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize),this.floors.push({id:0,floor:1,author:this.post.author,authorStr:this.post.authorStr,content:this.post.content,createdAt:this.post.createdAt,likeCount:this.post.likeCount}),this.loading=!1},async reloadPost(){const t=await i.loadPostSummary(this.postId);this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize)},async loadComments(){const t=await i.loadPostCommentsOfPage(this.postId,this.currentPage);this.floors.splice(0,this.floors.length),this.currentPage==1&&this.floors.push({id:0,floor:0,author:this.post.author,authorStr:_.resolveAddress(this.post.author),content:this.post.content,createdAt:this.post.createdAt,likeCount:this.post.likeCount});const e=(this.currentPage-1)*this.pageSize+1;for(let a=0;a<t.length;a++)t[a].floor=e+a,this.floors.push(t[a]);let l=[];for(const a of this.floors)l.push(a.author);_.addAddressList(l)},handlePageChange(t){this.currentPage=t,this.loadComments()},async handlePostComment(){if(!this.userStore.isConnected){k.warning("Please connect your wallet first");return}if(!this.newComment.trim()){k.warning("Comment cannot be empty");return}if(await i.loadSatoshiTokenBalance(this.userStore.walletAddress)<this.commentCost){C.alert("$Satoshi unenough");return}i.comment(this.postId,this.newComment.trim(),this.userStore.walletAddress,this.commentCost)},addressLink(t){return C.addressLink(t)}}},U={class:"post-page"},F={class:"title-header"},D={class:"floor-list"},M={class:"floor-header"},T={class:"author-info"},j={class:"author-name"},q=["href"],H={class:"post-time"},O={key:0,class:"floor-number"},W={class:"floor-content"},G={key:0,class:"pagination-wrapper"},J={class:"comment-actions"};function K(t,e,l,a,o,p){const y=m("el-button"),v=m("el-tag"),f=m("el-card"),S=m("el-pagination"),A=m("el-input"),b=B("loading");return c(),u("div",U,[d(y,{onClick:e[0]||(e[0]=s=>t.$router.back()),class:"back-button",icon:o.ArrowLeft},{default:h(()=>[...e[3]||(e[3]=[g(" Back to Forum ",-1)])]),_:1},8,["icon"]),L((c(),P(f,{class:"title-card"},{default:h(()=>[n("div",F,[n("h2",null,r(o.post.title),1),d(v,{type:"info"},{default:h(()=>[g(r(o.categoryNameList[o.post.category-1]),1)]),_:1})])]),_:1})),[[b,o.loading]]),n("div",D,[(c(!0),u(N,null,z(o.floors,s=>(c(),P(f,{key:s.id,class:"floor-card"},{default:h(()=>[n("div",M,[n("div",T,[n("div",j,[n("a",{href:p.addressLink(s.author),target:"_blank",class:"wallet-address"},r(s.authorStr),9,q)]),n("div",H,"Bitcoin #"+r(s.createdAt),1)]),s.floor>0?(c(),u("div",O,"#"+r(s.floor),1)):w("",!0)]),n("div",W,r(s.content),1)]),_:2},1024))),128)),o.post.id?(c(),u("div",G,[d(S,{"current-page":o.currentPage,"onUpdate:currentPage":e[1]||(e[1]=s=>o.currentPage=s),"page-size":o.pageSize,total:o.totalPage,layout:"prev, pager, next, total",onCurrentChange:p.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])):w("",!0)]),d(f,{class:"comment-form-card"},{default:h(()=>[e[4]||(e[4]=n("h4",null,"Leave a Comment",-1)),d(A,{modelValue:o.newComment,"onUpdate:modelValue":e[2]||(e[2]=s=>o.newComment=s),type:"textarea",rows:4,placeholder:"Write your comment here... (Emoji supported ðŸ˜Š)",maxlength:"51200","show-word-limit":""},null,8,["modelValue"]),n("div",J,[d(y,{type:"primary",onClick:p.handlePostComment},{default:h(()=>[g(" Post Comment ("+r(o.commentCost/100000000n)+" $Satoshi) ",1)]),_:1},8,["onClick"])])]),_:1})])}const R=I(E,[["render",K],["__scopeId","data-v-b5f85ba8"]]);export{R as default};
