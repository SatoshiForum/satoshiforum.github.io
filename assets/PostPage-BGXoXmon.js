import{_ as S,c as h,o as i,b as l,e as A,a as s,w as c,d as p,r as m,f as I,g as C,t as n,i as _,F as b,h as L,U as g,E as w,C as r,u as B,j as N}from"./index-DSfp38Jk.js";const x={name:"PostPage",data(){return{ArrowLeft:N,post:{},totalPage:0,totalComments:0,currentPage:1,pageSize:20,loading:!1,floors:[],newComment:"",likeCost:0n,commentCost:0n,categoryNameList:[]}},computed:{userStore(){return B()},postId(){return this.$route.params.id}},async mounted(){await this.loadPostAndContent(),await this.loadComments();const t=await r.queryForumBatchInfo();this.likeCost=t.likeCost,this.commentCost=t.commentCost,this.categoryNameList=t.categoryNames},activated(){let t=this;this.timer=setInterval(async()=>{t.post.id&&(t.reloadPost(),t.floors.length<this.pageSize&&t.loadComments())},5e3)},deactivated(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{async loadPostAndContent(){this.loading=!0;const t=await r.loadPostSummary(this.postId),e=await r.loadPostContent(this.postId);this.post={id:this.postId,title:t.title,category:t.categoryId,author:t.creator,shortAddress:g.makeShortAddress(t.creator),content:e,createdAt:t.createBlock},this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize),this.floors.push({id:0,author:this.post.author,shortAddress:this.post.shortAddress,content:this.post.content,createdAt:this.post.createdAt}),this.loading=!1},async reloadPost(){const t=await r.loadPostSummary(this.postId);this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize)},async loadComments(){const t=await r.loadPostCommentsOfPage(this.postId,this.currentPage);this.floors.splice(0,this.floors.length),this.currentPage==1&&this.floors.push({id:0,author:this.post.author,shortAddress:this.post.shortAddress,content:this.post.content,createdAt:this.post.createdAt});for(const e of t)this.floors.push(e)},handlePageChange(t){this.currentPage=t,this.loadComments()},async handlePostComment(){if(!this.userStore.isConnected){w.warning("Please connect your wallet first");return}if(!this.newComment.trim()){w.warning("Comment cannot be empty");return}if(await r.loadSatoshiTokenBalance(this.userStore.walletAddress)<this.commentCost){g.alert("$Satoshi unenough");return}r.comment(this.postId,this.newComment.trim(),this.userStore.walletAddress,this.commentCost)},addressLink(t){return g.addressLink(t)}}},z={class:"post-page"},V={class:"title-header"},U={class:"floor-list"},E={class:"floor-header"},F={class:"author-info"},D={class:"author-name"},M=["href"],j={class:"post-time"},T={class:"floor-number"},q={class:"floor-content"},H={key:0,class:"pagination-wrapper"},O={class:"comment-actions"};function W(t,e,G,J,o,d){const f=m("el-button"),y=m("el-tag"),u=m("el-card"),P=m("el-pagination"),v=m("el-input"),k=I("loading");return i(),h("div",z,[l(f,{onClick:e[0]||(e[0]=a=>t.$router.back()),class:"back-button",icon:o.ArrowLeft},{default:c(()=>[...e[3]||(e[3]=[p(" Back to Forum ",-1)])]),_:1},8,["icon"]),A((i(),C(u,{class:"title-card"},{default:c(()=>[s("div",V,[s("h2",null,n(o.post.title),1),l(y,{type:"info"},{default:c(()=>[p(n(o.categoryNameList[o.post.category-1]),1)]),_:1})])]),_:1})),[[k,o.loading]]),s("div",U,[(i(!0),h(b,null,L(o.floors,a=>(i(),C(u,{key:a.id,class:"floor-card"},{default:c(()=>[s("div",E,[s("div",F,[s("div",D,[d.userStore.isConnected?(i(),h("a",{key:0,href:d.addressLink(d.userStore.walletAddress),target:"_blank",class:"wallet-address"},n(a.shortAddress),9,M)):_("",!0)]),s("div",j,"Bitcoin #"+n(a.createdAt),1)]),s("div",T,"#"+n(a.floor),1)]),s("div",q,n(a.content),1)]),_:2},1024))),128)),o.post.id?(i(),h("div",H,[l(P,{"current-page":o.currentPage,"onUpdate:currentPage":e[1]||(e[1]=a=>o.currentPage=a),"page-size":o.pageSize,total:o.totalPage,layout:"prev, pager, next, total",onCurrentChange:d.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])):_("",!0)]),l(u,{class:"comment-form-card"},{default:c(()=>[e[4]||(e[4]=s("h4",null,"Leave a Comment",-1)),l(v,{modelValue:o.newComment,"onUpdate:modelValue":e[2]||(e[2]=a=>o.newComment=a),type:"textarea",rows:4,placeholder:"Write your comment here... (Emoji supported ðŸ˜Š)",maxlength:"51200","show-word-limit":""},null,8,["modelValue"]),s("div",O,[l(f,{type:"primary",onClick:d.handlePostComment},{default:c(()=>[p(" Post Comment ("+n(o.commentCost/100000000n)+" $Satoshi) ",1)]),_:1},8,["onClick"])])]),_:1})])}const Q=S(x,[["render",W],["__scopeId","data-v-2f56de12"]]);export{Q as default};
