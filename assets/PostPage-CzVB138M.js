import{_ as I,c as f,o as d,b as l,e as b,a as s,w as c,d as g,r as m,f as L,g as P,t as r,i as B,F as N,h as x,U as C,E as w,C as i,N as _,u as z,j as V}from"./index-iyfmY-EO.js";const E={name:"PostPage",data(){return{ArrowLeft:V,post:{},totalPage:0,totalComments:0,currentPage:1,pageSize:20,loading:!1,floors:[],newComment:"",likeCost:0n,commentCost:0n,categoryNameList:[]}},computed:{userStore(){return z()},postId(){return this.$route.params.id}},async mounted(){let t=this;this.timer=setInterval(async()=>{t.post.id&&(t.reloadPost(),t.floors.length<this.pageSize&&t.loadComments())},5e3),C.registerEventByType("nameEntryUpdate",function(n){for(const h of t.floors)h.author==n.data.address&&(h.authorStr=n.data.name)}),await this.loadPostAndContent(),await this.loadComments();const e=await i.queryForumBatchInfo();this.likeCost=e.likeCost,this.commentCost=e.commentCost,this.categoryNameList=e.categoryNames},unmounted(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{async loadPostAndContent(){this.loading=!0;const t=await i.loadPostSummary(this.postId),e=await i.loadPostContent(this.postId);this.post={id:this.postId,title:t.title,category:t.categoryId,author:t.creator,authorStr:_.resolveAddress(t.creator),content:e,createdAt:t.createBlock,likeCount:t.likeCount},this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize),this.floors.push({id:0,author:this.post.author,authorStr:this.post.authorStr,content:this.post.content,createdAt:this.post.createdAt,likeCount:this.post.likeCount}),this.loading=!1},async reloadPost(){const t=await i.loadPostSummary(this.postId);this.totalComments=t.commentCount,this.totalPage=Math.ceil((this.totalComments+1)/this.pageSize)},async loadComments(){const t=await i.loadPostCommentsOfPage(this.postId,this.currentPage);this.floors.splice(0,this.floors.length),this.currentPage==1&&this.floors.push({id:0,author:this.post.author,authorStr:_.resolveAddress(this.post.author),content:this.post.content,createdAt:this.post.createdAt,likeCount:this.post.likeCount});for(const n of t)this.floors.push(n);let e=[];for(const n of this.floors)e.push(n.author);_.addAddressList(e)},handlePageChange(t){this.currentPage=t,this.loadComments()},async handlePostComment(){if(!this.userStore.isConnected){w.warning("Please connect your wallet first");return}if(!this.newComment.trim()){w.warning("Comment cannot be empty");return}if(await i.loadSatoshiTokenBalance(this.userStore.walletAddress)<this.commentCost){C.alert("$Satoshi unenough");return}i.comment(this.postId,this.newComment.trim(),this.userStore.walletAddress,this.commentCost)},addressLink(t){return C.addressLink(t)}}},U={class:"post-page"},F={class:"title-header"},D={class:"floor-list"},M={class:"floor-header"},T={class:"author-info"},j={class:"author-name"},q=["href"],H={class:"post-time"},O={class:"floor-number"},W={class:"floor-content"},G={key:0,class:"pagination-wrapper"},J={class:"comment-actions"};function K(t,e,n,h,o,u){const y=m("el-button"),v=m("el-tag"),p=m("el-card"),k=m("el-pagination"),S=m("el-input"),A=L("loading");return d(),f("div",U,[l(y,{onClick:e[0]||(e[0]=a=>t.$router.back()),class:"back-button",icon:o.ArrowLeft},{default:c(()=>[...e[3]||(e[3]=[g(" Back to Forum ",-1)])]),_:1},8,["icon"]),b((d(),P(p,{class:"title-card"},{default:c(()=>[s("div",F,[s("h2",null,r(o.post.title),1),l(v,{type:"info"},{default:c(()=>[g(r(o.categoryNameList[o.post.category-1]),1)]),_:1})])]),_:1})),[[A,o.loading]]),s("div",D,[(d(!0),f(N,null,x(o.floors,a=>(d(),P(p,{key:a.id,class:"floor-card"},{default:c(()=>[s("div",M,[s("div",T,[s("div",j,[s("a",{href:u.addressLink(a.author),target:"_blank",class:"wallet-address"},r(a.authorStr),9,q)]),s("div",H,"Bitcoin #"+r(a.createdAt),1)]),s("div",O,"#"+r(a.floor),1)]),s("div",W,r(a.content),1)]),_:2},1024))),128)),o.post.id?(d(),f("div",G,[l(k,{"current-page":o.currentPage,"onUpdate:currentPage":e[1]||(e[1]=a=>o.currentPage=a),"page-size":o.pageSize,total:o.totalPage,layout:"prev, pager, next, total",onCurrentChange:u.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])):B("",!0)]),l(p,{class:"comment-form-card"},{default:c(()=>[e[4]||(e[4]=s("h4",null,"Leave a Comment",-1)),l(S,{modelValue:o.newComment,"onUpdate:modelValue":e[2]||(e[2]=a=>o.newComment=a),type:"textarea",rows:4,placeholder:"Write your comment here... (Emoji supported ðŸ˜Š)",maxlength:"51200","show-word-limit":""},null,8,["modelValue"]),s("div",J,[l(y,{type:"primary",onClick:u.handlePostComment},{default:c(()=>[g(" Post Comment ("+r(o.commentCost/100000000n)+" $Satoshi) ",1)]),_:1},8,["onClick"])])]),_:1})])}const R=I(E,[["render",K],["__scopeId","data-v-114f4f18"]]);export{R as default};
